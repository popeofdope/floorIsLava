<script src="/socket.io/socket.io.js"></script>


<script>

let socket = io();

const imageLinks = ['./static/block0.png','./static/block1.png','./static/block2.png','./static/block3.png','./static/block4.png','./static/block5.png','./static/player.png','./static/playerDeath.png'];
let graphics = [];
let playerImg, block0, block1, block2, block3, block4, block5, playerDeath;
let images = {playerImg, block0, block1, block2, block3, block4, block5, playerDeath};

imageLinks.forEach(imageLink => {
    let img = new Image();
    img.src = imageLink;
    img.onload = () => {
        switch (imageLink) {
            case './static/block0.png':
                images.block0 = img;
                break;
            case './static/block1.png':
                images.block1 = img;
                break;
            case './static/block2.png':
                images.block2 = img;
                break;
            case './static/block3.png':
                images.block3 = img;
                break;
            case './static/block4.png':
                images.block4 = img;
                break;
            case './static/block5.png':
                images.block5 = img;
                break;
            case './static/player.png':
                images.playerImg = img;
                break;
/*             case './static/playerDeath.png':
                images.playerDeath = img; 
                break; */
        }
        graphics.push(img);
        if(graphics.length === 8) {
            drawGame();
        }
    }
});

function drawGame() {
    socket.on('returnState', (state) => {
        if (!state.map) {
            return
        }
        //Draw the game
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext('2d');
        for (let i = 0; i < state.map.length; i++) {
            for (let j = 0; j < state.map[i].length; j++) {
                // Draw blocks
                console.log("block" + state.map[i][j].health);
                ctx.drawImage(images["block" + state.map[i][j].health], i*32, j*32, 32, 32);
            }
        }
        // Draw players
        state.playersArray.forEach(player => {
            ctx.drawImage(images.playerImg, player.position.x*32, player.position.y*32, 32, 32);
        })
        //console.log(state);
    }) // Return State
}


document.addEventListener('keydown',(ev) => {
    //console.log(ev.key)
    switch(ev.key){
        case 'ArrowRight':
            socket.emit('move','right')
            break;
        case 'ArrowLeft':
            socket.emit('move','left')
            break;
        case 'ArrowUp':
        socket.emit('move','up')
            break;   
        case 'ArrowDown':
        socket.emit('move','down')
            break;             
    }
})

</script>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <body>
        <canvas id="canvas" width="640" height="640"></canvas>
    </body>
</head>
<body>
    
</body>
</html>